<!DOCTYPE html>
<html>
<head>
	<title>ASCII TETRIS</title>

	<style type="text/css">
		body{
			font-family: 'Lucida Console';
		}
	</style>

	<script type="text/javascript">
		(function(){
			const dimensions = {
				w: 20,
				h: 20,
			};
			const maxTilesAmount = dimensions.w * dimensions.h;
			const tileDim = 4;
			const arrTiles = [];
			const arrPlayerTiles = [];
			const tileShapes = [
				[
					0,0,1,0,
					0,1,1,0,
					0,1,0,0,
					0,0,0,0,
				],
				[
					0,0,1,0,
					0,0,1,0,
					0,0,1,0,
					0,0,1,0,
				],
			];
			const KEYS = {
				UP: 38,
				DOWN: 40,
				LEFT: 37,
				RIGHT: 39,
			};
			const MAX_ROTATE_TYPE = 3;

			var posX = 0;
			var currShapeIndex = Math.floor(Math.random() * tileShapes.length);
			var rotationType = 0;
			var elemScreen;

			var currUnicodeTile = 65;

			window.onload = function(){
				elemScreen = document.getElementsByTagName('body')[0];

				for(var i = 0; i < dimensions.h; i++){
					arrTiles.push(new Tile(0, i, '#'));
					arrTiles.push(new Tile(dimensions.w, i, '#'));
				}

				createPlayerTiles();

				window.addEventListener('keydown', function(e){
					var key = e.which || e.keyCode;

					for(var i = 0, j = arrPlayerTiles.length; i < j; i++){
						var tile = arrPlayerTiles[i];

						switch(key){
							case KEYS.UP : 
								break;
							case KEYS.DOWN : 
								break;
							case KEYS.LEFT : 
								tile.posX--;
								break;
							case KEYS.RIGHT : 
								tile.posX++;
								break;
						}
					}

					switch(key){
						case KEYS.UP : 
							rotationType = (rotationType + 1) % (MAX_ROTATE_TYPE + 1);
							rotatePlayerTiles();
							break;
						case KEYS.DOWN : 
							break;
						case KEYS.LEFT : 
							posX--;
							break;
						case KEYS.RIGHT : 
							posX++;
							break;
					}

					updateGraphics();
				}, false);

				updateGraphics();
			}

			function updateGraphics(){
				var res = "";

				for(var row = 0; row <= dimensions.h; row++)
				{
					for(var col = 0; col <= dimensions.w; col++)
					{
						var targetTile = null;
						for(var i = 0, j = arrTiles.length; i < j; i++)
						{
							var tile = arrTiles[i];
							if(tile.posX === col && tile.posY === row){
								targetTile = tile;
								break;
							}
						}
						res += targetTile !== null ? targetTile.char : '&nbsp;';
					}

					res += '<br/>';
				}

				elemScreen.innerHTML = res;
			}

			function createPlayerTiles(){
				posX = Math.floor(dimensions.w / 2) - Math.floor(tileDim / 2);
				rotationType = 0;
				rotatePlayerTiles();
			}

			function rotatePlayerTiles(){
				for(var i = 0, j = arrTiles.length; i < j; i++){
					var tile = arrTiles[i];
					if(arrPlayerTiles.indexOf(tile) !== -1){
						arrTiles.splice(i, 1);
						i--;
						j--;
					}
				}

				arrPlayerTiles.splice(0, arrPlayerTiles.length);

				var arrShape = tileShapes[currShapeIndex];

				for(var row = 0; row <= tileDim; row++)
				{
					for(var col = 0; col <= tileDim; col++)
					{
						var newTile;
						switch(rotationType){
							case 0 : 
								var int = arrShape[col + row * tileDim];
								if(int === 1)
									newTile = new Tile(col + posX, row, String.fromCharCode(currUnicodeTile));
								break;
							case 1 : 
								var int = arrShape[(col + 1) * (tileDim - 1)];
								if(int === 1)
									newTile = new Tile(col + posX, row, String.fromCharCode(currUnicodeTile));
								break;
							case 2 : 
								break;
							case 3 : 
								break;
						}

						if(newTile instanceof Tile){
							arrTiles.push(newTile);
							arrPlayerTiles.push(newTile);
							newTile = null;
						}
					}
				}
			}

			function Tile(posX, posY, char){
				this.posX = posX;
				this.posY = posY;
				this.char = char;
			}
		}());
	</script>
</head>
<body>
</body>
</html>