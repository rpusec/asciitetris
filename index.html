<!DOCTYPE html>
<html>
<head>
	<title>ASCII TETRIS</title>

	<style type="text/css">
		body{
			font-family: 'Lucida Console';
		}
	</style>

	<script type="text/javascript">
		(function(){
			const dimensions = {
				w: 20,
				h: 20,
			};
			const assets = {
				bg: '&nbsp;',
				wall: '#',
			};
			const maxTilesAmount = dimensions.w * dimensions.h;
			const tileDim = 4;
			const arrTiles = [];
			const tileShapes = [
				[
					0,0,1,0,
					0,1,1,0,
					0,1,0,0,
					0,0,0,0,
				],
				[
					0,0,1,0,
					0,0,1,0,
					0,0,1,0,
					0,0,1,0,
				],
			];
			const KEYS = {
				UP: 38,
				DOWN: 40,
				LEFT: 37,
				RIGHT: 39,
			};

			const pos = {
				x: Math.floor(dimensions.w / 2) - Math.floor(tileDim / 2),
				y: 0,
			};

			var currShapeIndex = Math.floor(Math.random() * tileShapes.length);
			var elemScreen;

			var currUnicodeTile = 65;

			window.onload = function(){
				elemScreen = document.getElementsByTagName('body')[0];

				window.addEventListener('keydown', function(e){
					var key = e.which || e.keyCode;

					switch(key){
						case KEYS.UP : 
							break;
						case KEYS.DOWN : 
							break;
						case KEYS.LEFT : 
							pos.x--;
							break;
						case KEYS.RIGHT : 
							pos.x++;
							break;
					}

					console.log(JSON.stringify(pos));

					updateGraphics();
				}, false);

				updateGraphics();
			}

			function updateGraphics(){
				var currShape = tileShapes[currShapeIndex];
				var tileIndex = 0;

				arrTiles.splice(0, arrTiles.length);

				for(var i = 0; i < maxTilesAmount; i++){
					if((i % dimensions.w) >= pos.x && (i % dimensions.w) <= (pos.x + tileDim - 1) && i <= dimensions.w * tileDim){
						var t = currShape[tileIndex];
						tileIndex++;
						if(t == 1){
							arrTiles.push(String.fromCharCode(currUnicodeTile));
							continue;
						}
					}

					if((i % dimensions.w) === 0 || ((i + 1) % dimensions.w) === 0){
						arrTiles.push(assets.wall);
					}
					else{
						arrTiles.push(assets.bg);
					}
				}

				var res = '';
				for(var i = 0; i < maxTilesAmount; i++){
					res += arrTiles[i];
					if(((i + 1) % dimensions.w) === 0)
						res += '<br/>';
				}
				elemScreen.innerHTML = res;
			}
		}());
	</script>
</head>
<body>
</body>
</html>